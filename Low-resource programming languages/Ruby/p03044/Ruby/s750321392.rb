*q,E=2,$<.flat_map{|l|u,v,w=l=l.split.map(&:to_i);[l,[v,u,w]]}.group_by{|u,|u};q.map{|i|$*[i]||=(E[i/2]&.map{|_,v,w|v&&q<<=v*2|i+w&1};i&1)};puts$*